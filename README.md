# praktikum_new_diplom

Foodgram-project

### О проекте:

Проект Foodgram - социальная сеть в которой пользователи делятся своими рецептами.
В проекте реализованы 3 уровня доступа:
- Неавторизованный пользователь - может просматривать список рецептов и отделные рецепты, список пользователей и профиль отдельного пользователя, может зарегистрироваться по email и паролю. У каждого рецепта есть тэги,  фильтрация по тэгам осуществляется по принципу "или".
- Авторизованный пользователь - может совершать все действия неавторизованного пользователя, может менять свой пароль. Может создавать свои рецепты, выбор ингредиентов рецепта происходит  из предустановленного списка с поиском и фильтрацией по списку. Может добавлять любые рецепты в список избранных. Может подписываться на других пользователей проекта и в разделе подписок видеть рецепты этих пользователей. Может добавлять рецепты в список покупок. Может загрузить список покупок в виде pdf файла, при этом количество одинаковых ингредиентов из разных рецептов в списке покупок будет суммироваться.
- Администратор - может совершать все действия авторизованного пользователя. Имеет доступ к административной панели. В административной панели может отсортировать рецепты по популярности. Имеет полный доступ к созданию и удалению любых объектов проекта. Может менять пароли пользователей.

Авторизация пользователей ведется через токены.

### Структура проекта:
Проект представляет собой Docker сеть в составе:
- Контейнер db - контейнер управления базой данных, база данных реализована на Postgres 13
- Контейнер frontend - контейнер фронтенда
- Контейнер backend - контейнер бэкенда на gunicorn
- Контейнер nginx - контейнер маршрутизации внутри Docker network
- Том pg_data - база данных
- Том static - статика проекта
- Том media - том для хранения медиа(изображения)

Проект доступен в интернете по адресу https://proulibki.com и располагается на учебном сервере Yandex

Настроен мониторинг доступности сайта.

Настроено автоматическое развертывание/обновление проекта по git push

### Структура бэкенда:
- Стандартная административная панель Django с дополнительным полем популярности рецептов с возможностью сортировки и выбором цвета тэга при его создании с помощью цветовой палитры
- Приложение api - маршрутизация запросов к бэкенду
- Приложение recipes - модели, вьюсеты и сериализаторы для рецептов
- Приложение users - модели, вьюсеты и сериализаторы для пользователей
- Утилита создания pdf файла для загрузки/печати


Классы приложения recipes и их поля:
 
- Recipe:
    - name - название рецепта
    - author - автор, связанное поле с моделью User
    - image - изображение блюда
    - text - инструкции по приготовлению
    - ingredients - поле многие-ко-многим, связанное с моделью Ingredient через модель RecipeIngredient, поля
    - recipe, ingredient; related_name='recipe_ingredients'
    - cooking_time - поле время готовки, тип DurationField, хранит объекты timedelta
    - tags - поле многие-ко-многим, связанное с моделью Tag через модель RecipeTag, поля recipe, tag

    - свойство is_favorited - показывает находится ли рецепт в избранном у запрашивающего пользователя
    - свойство is_in_shopping_cart - показывает находится ли рецепт в списке покупок у запрашивающего пользователя

- ShoppingCart

    - author - автор, связанное поле с моделью User, related_name='user_shopping_cart'
    - recipe - поле многие-ко-многим, связанное с моделью Recipe через модель ShoppingCartRecipe, поля
    - shopping_cart, recipe

- Ingredient
    
    - name - название ингредиента
    - measurement_units - единицы измерения

- Tag(models.Model):
   
    - name - название тэга
    - color - цвет тэга, хранится в виде HEX кода цвета
    - slug = слаг тэга

- RecipeIngredient

    Модель связи рецепта и ингредиента.
    Содержит количество ингредиента для рецепта.
    
    - recipe - связанное поле с моделью Recipe
    - ingredient - связанное поле с моделью Ingredient
    - amount количество ингредиента, поле для хранения десятичных чисел длиной 7 символов с 3 знаками после запятой


- RecipeTag
    Модель связи рецепта и тэга.

    - recipe - связанное поле с моделью Recipe
    - tag - связанное поле с моделью Tag


- ShoppingCartRecipe(models.Model):
    Модель связи списка покупок и рецепта.

    - shopping_cart - связанное поле с моделью ShoppingCart
    - recipe - связанное поле с моделью Recipe


- Favourite(models.Model):
    Избранные рецепты.

    - user - связанное поле с моделью User
    - recipe - связанное поле с моделью Recipe
    - created - автоматически создающееся поле сохраняющее дату и время создания объекта

Классы приложения users и их поля:

- User
    Кастомная модель User.

    - email - email пользователя

    - is_subscribed - свойство пользователя возвращает информацию о том подписан ли запрашивающий пользователь на того пользователя о котором он запрашивает информацию

- Subscription(models.Model):
    Подписка.

    - user - связанное поле с моделью User; related_name='follower',
    - author - связанное поле с моделью User; related_name='following'
    - created - автоматически создающееся поле сохраняющее дату и время создания объекта

    На уровне модели запрещена подписка на себя и повторная подписка на другого пользователя.


#### Основные адреса проекта:
Административная панель
```
http://proulibki.com/admin/
```
Основной адрес API:
```
http://proulibki.com/api/
```
Документация по API:
```
http://proulibki.com/api/docs/
```

### Как запустить проект:
Запуск проекта настроен в файле docker-compose.production.yml
Для запуска необходимо установить в систему Docker, запустить сборку контейнеров командой 

```
sudo docker compose -f docker-compose.production.yml up
```
После этого проект будет доступен по локальному адресу 
```
http://127.0.0.1:8000
```
Если необходимо настроить работу проекта на сервере необходимо перенаправлять запросы на этот внутренний адрес сервера

